<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>工业互联网考试系统</title>
  <style>
    body {
        font-family: 'Microsoft YaHei', Arial, sans-serif;
        line-height: 1.6;
        max-width: 900px;
        margin: 0 auto;
        padding: 20px;
        background-color: #f0f4f8;
        color: #333;
        transition: all 0.3s ease;
    }
    .container {
        background-color: white;
        border-radius: 12px;
        padding: 25px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
    }
    .container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, #3498db, #2ecc71);
    }
    h1 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 30px;
        font-size: 2.2rem;
        font-weight: 600;
        position: relative;
        padding-bottom: 15px;
    }
    h1::after {
        content: '';
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 3px;
        background: linear-gradient(90deg, #3498db, #2ecc71);
    }
    h2 {
        color: #2c3e50;
        margin-bottom: 20px;
        font-weight: 500;
    }
    .question {
        margin-bottom: 30px;
        padding: 20px;
        border-radius: 10px;
        background-color: #ffffff;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        border-left: 4px solid #3498db;
        transition: transform 0.2s, box-shadow 0.2s;
    }
    .question:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }
    .question-title {
        font-weight: bold;
        margin-bottom: 15px;
        color: #2c3e50;
        font-size: 1.1rem;
        line-height: 1.5;
    }
    .options {
        display: flex;
        flex-direction: column;
        gap: 10px;
    }
    .option {
        margin-left: 5px;
        padding: 8px 10px;
        border-radius: 6px;
        transition: background-color 0.2s;
    }
    .option:hover {
        background-color: #f7f9fc;
    }
    .option label {
        cursor: pointer;
        display: inline-block;
        width: 100%;
    }
    .option input[type="radio"] {
        margin-right: 10px;
        transform: scale(1.2);
    }
    .btn {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        border: none;
        padding: 12px 25px;
        border-radius: 50px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 500;
        display: block;
        margin: 25px auto;
        transition: all 0.3s;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    .btn:hover {
        background: linear-gradient(135deg, #2980b9, #3498db);
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
    }
    .btn:active {
        transform: translateY(0);
    }
    .btn-secondary {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
    }
    .btn-secondary:hover {
        background: linear-gradient(135deg, #27ae60, #2ecc71);
    }
    .btn-danger {
        background: linear-gradient(135deg, #e74c3c, #c0392b);
    }
    .btn-danger:hover {
        background: linear-gradient(135deg, #c0392b, #e74c3c);
    }
    #results {
        margin-top: 30px;
        padding: 20px;
        border-radius: 10px;
        background-color: #ffffff;
        box-shadow: 0 3px 15px rgba(0, 0, 0, 0.08);
        display: none;
    }
    .result-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding-bottom: 15px;
        border-bottom: 2px solid #f0f4f8;
    }
    .correct {
        color: #27ae60;
    }
    .incorrect {
        color: #e74c3c;
    }
    .filter-controls {
        margin: 20px 0;
        text-align: center;
    }
    .filter-btn {
        background-color: #f7f9fc;
        border: 1px solid #ddd;
        padding: 8px 15px;
        margin: 0 5px;
        border-radius: 20px;
        cursor: pointer;
        transition: all 0.3s;
        font-weight: 500;
    }
    .filter-btn:hover {
        background-color: #e6f0ff;
    }
    .filter-btn.active {
        background-color: #3498db;
        color: white;
        border-color: #3498db;
        box-shadow: 0 2px 8px rgba(52, 152, 219, 0.3);
    }
    .hidden {
        display: none;
    }
    .status {
        font-weight: bold;
        margin-left: 10px;
        padding: 4px 10px;
        border-radius: 20px;
        font-size: 0.9rem;
    }
    .status.correct {
        background-color: rgba(46, 204, 113, 0.15);
    }
    .status.incorrect {
        background-color: rgba(231, 76, 60, 0.15);
    }
    .progress {
        margin: 25px 0;
        height: 8px;
        background-color: #e6eef5;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1);
    }
    .progress-bar {
        height: 100%;
        background: linear-gradient(90deg, #3498db, #2ecc71);
        width: 0;
        transition: width 0.5s;
        border-radius: 10px;
    }
    /* 密码保护和题目数量选择样式 */
    .password-container, .mode-selection-container, .question-count-container {
        text-align: center;
        margin: 50px auto;
        max-width: 500px;
        background: white;
        padding: 30px;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        position: relative;
        overflow: hidden;
    }
    .password-container::before, .mode-selection-container::before, .question-count-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 5px;
        background: linear-gradient(90deg, #3498db, #2ecc71);
    }
    .password-input, .question-count-input {
        width: 100%;
        padding: 15px;
        font-size: 16px;
        border: 2px solid #e6eef5;
        border-radius: 8px;
        margin: 15px 0;
        transition: all 0.3s;
        box-sizing: border-box;
    }
    .password-input:focus, .question-count-input:focus {
        border-color: #3498db;
        outline: none;
        box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
    }
    .error-message {
        color: #e74c3c;
        margin-top: 15px;
        display: none;
        padding: 10px;
        background-color: rgba(231, 76, 60, 0.1);
        border-radius: 6px;
        font-weight: 500;
    }
    /* 用时显示样式 */
    #timer {
        text-align: center;
        font-size: 18px;
        margin-bottom: 25px;
        color: #2c3e50;
        background: #f7f9fc;
        padding: 10px;
        border-radius: 30px;
        font-weight: 500;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }
    /* 模式选择样式 */
    .mode-btn-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin: 30px 0;
    }
    .mode-btn {
        padding: 15px 30px;
        font-size: 18px;
        border-radius: 10px;
        border: none;
        cursor: pointer;
        transition: all 0.3s;
        width: 180px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        font-weight: 500;
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
    }
    .mode-btn i {
        font-size: 24px;
        margin-bottom: 5px;
    }
    .mode-btn.exam-mode {
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
    }
    .mode-btn.practice-mode {
        background: linear-gradient(135deg, #2ecc71, #27ae60);
        color: white;
    }
    .mode-btn:hover {
        transform: translateY(-3px);
        box-shadow: 0 7px 20px rgba(0, 0, 0, 0.15);
    }
    .mode-btn:active {
        transform: translateY(-1px);
    }
    /* 答案反馈样式 */
    .answer-feedback {
        margin-top: 10px;
        padding: 12px;
        border-radius: 8px;
        font-weight: 500;
        display: none;
    }
    .answer-feedback.correct {
        background-color: rgba(46, 204, 113, 0.15);
        color: #27ae60;
        border-left: 4px solid #27ae60;
    }
    .answer-feedback.incorrect {
        background-color: rgba(231, 76, 60, 0.15);
        color: #e74c3c;
        border-left: 4px solid #e74c3c;
    }
    /* 结果页面样式优化 */
    .result-summary {
        display: flex;
        justify-content: space-around;
        margin: 20px 0 30px;
        padding: 20px;
        background: #f7f9fc;
        border-radius: 10px;
    }
    .result-item {
        text-align: center;
    }
    .result-item .value {
        font-size: 2rem;
        font-weight: bold;
        color: #2c3e50;
        display: block;
        margin-bottom: 5px;
    }
    .result-item .label {
        font-size: 0.9rem;
        color: #7f8c8d;
    }
    /* 图标 */
    .icon {
        display: inline-block;
        width: 24px;
        height: 24px;
        background-size: contain;
        background-repeat: no-repeat;
        background-position: center;
        vertical-align: middle;
        margin-right: 8px;
    }
    /* 响应式设计 */
    @media (max-width: 768px) {
        body {
            padding: 10px;
        }
        .container {
            padding: 15px;
        }
        .mode-btn-container {
            flex-direction: column;
            align-items: center;
        }
        .result-summary {
            flex-direction: column;
            gap: 15px;
        }
    }
    /* 高亮当前题目 */
    .current-question {
        border-left-color: #f39c12;
        background-color: #fffcf5;
    }
    /* 选项选中后的样式 */
    .option.selected {
        background-color: #e6f0ff;
        border-left: 3px solid #3498db;
    }
    /* 动画效果 */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }
    .fade-in {
        animation: fadeIn 0.5s ease forwards;
    }
    
    /* 主题切换按钮 */
    .theme-toggle {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #3498db, #2980b9);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        transition: all 0.3s;
    }
    .theme-toggle:hover {
        transform: scale(1.1);
    }
    
    /* 暗色主题 */
    body.dark-theme {
        background-color: #1a1a2e;
        color: #f0f0f0;
    }
    body.dark-theme .container,
    body.dark-theme .question,
    body.dark-theme #results,
    body.dark-theme .password-container,
    body.dark-theme .mode-selection-container,
    body.dark-theme .question-count-container {
        background-color: #16213e;
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    }
    body.dark-theme h1,
    body.dark-theme h2,
    body.dark-theme .question-title {
        color: #f0f0f0;
    }
    body.dark-theme .option:hover {
        background-color: #1f3156;
    }
    body.dark-theme .option.selected {
        background-color: #1f3156;
    }
    body.dark-theme .password-input,
    body.dark-theme .question-count-input {
        background-color: #242c48;
        border-color: #2a365c;
        color: #f0f0f0;
    }
    body.dark-theme #timer {
        background-color: #1f3156;
        color: #f0f0f0;
    }
    body.dark-theme .filter-btn {
        background-color: #242c48;
        border-color: #2a365c;
        color: #f0f0f0;
    }
    body.dark-theme .progress {
        background-color: #242c48;
    }
  </style>
  <!-- 添加一些图标 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
  <!-- 主题切换按钮 -->
  <div class="theme-toggle" id="theme-toggle">
    <i class="fas fa-moon"></i>
  </div>

  <!-- 密码保护层 -->
  <div id="password-protection" class="password-container fade-in">
      <h2><i class="fas fa-lock"></i> 请输入密码访问考试系统</h2>
      <input type="password" id="password-input" class="password-input" placeholder="请输入密码" autofocus>
      <button id="password-submit" class="btn"><i class="fas fa-sign-in-alt"></i> 提交</button>
      <div id="error-message" class="error-message"><i class="fas fa-exclamation-circle"></i> 密码错误，请重试！</div>
  </div>

  <!-- 模式选择层 -->
  <div id="mode-selection" class="mode-selection-container hidden fade-in">
      <h2><i class="fas fa-tasks"></i> 请选择学习模式</h2>
      <p>选择适合您的学习方式</p>
      <div class="mode-btn-container">
          <button id="practice-mode-btn" class="mode-btn practice-mode">
              <i class="fas fa-book"></i>
              练习模式
              <small>做题后立即查看答案</small>
          </button>
          <button id="exam-mode-btn" class="mode-btn exam-mode">
              <i class="fas fa-clipboard-check"></i>
              考试模式
              <small>提交后统一查看结果</small>
          </button>
      </div>
  </div>

  <!-- 题目数量选择层 -->
  <div id="question-count-selection" class="question-count-container hidden fade-in">
      <h2><i class="fas fa-list-ol"></i> 请选择题目数量</h2>
      <p>题库总数：235题</p>
      <input type="number" id="question-count-input" class="question-count-input" min="1" max="235" placeholder="请输入题目数量（1-235）" autofocus>
      <button id="question-count-submit" class="btn"><i class="fas fa-play"></i> 开始练习</button>
      <div id="count-error-message" class="error-message"><i class="fas fa-exclamation-circle"></i> 请输入有效的题目数量！</div>
  </div>

  <!-- 考试系统内容 -->
  <div id="exam-content" class="hidden fade-in">
      <div class="container">
          <h1>工业互联网考试系统</h1>
          
          <!-- 显示当前模式 -->
          <div id="current-mode" style="text-align: center; margin-bottom: 15px; font-weight: bold; color: #3498db;"></div>
          
          <!-- 显示作答用时 -->
          <div id="timer"><i class="fas fa-clock"></i> 已用时: 00:00</div>
          
          <div class="progress">
              <div class="progress-bar" id="progress-bar"></div>
          </div>
          
          <div id="exam-form">
              <!-- 题目由 JavaScript 动态生成 -->
          </div>
          
          <button id="submit-btn" class="btn"><i class="fas fa-paper-plane"></i> 提交答案</button>
          
          <div id="results">
              <div class="result-header">
                  <h2><i class="fas fa-chart-pie"></i> 测试结果</h2>
                  <div>
                      <span id="score">0</span>/<span id="total">0</span>
                      <span>正确率: <span id="accuracy">0%</span></span>
                  </div>
              </div>
              
              <!-- 结果统计卡片 -->
              <div class="result-summary">
                  <div class="result-item">
                      <span class="value" id="summary-score">0</span>
                      <span class="label">得分</span>
                  </div>
                  <div class="result-item">
                      <span class="value" id="summary-total">0</span>
                      <span class="label">总题数</span>
                  </div>
                  <div class="result-item">
                      <span class="value" id="summary-accuracy">0%</span>
                      <span class="label">正确率</span>
                  </div>
                  <div class="result-item">
                      <span class="value" id="summary-time">00:00</span>
                      <span class="label">用时</span>
                  </div>
              </div>
              
              <!-- 显示总作答用时 -->
              <div id="final-time" style="text-align: center; font-size: 16px; margin-bottom: 15px;"></div>
              
              <div class="filter-controls">
                  <button class="filter-btn active" data-filter="all"><i class="fas fa-list"></i> 全部题目</button>
                  <button class="filter-btn" data-filter="incorrect"><i class="fas fa-times"></i> 错题复习</button>
              </div>
              
              <div id="result-details">
                  <!-- 结果详情由 JavaScript 动态生成 -->
              </div>
              
              <div style="text-align: center; margin-top: 30px;">
                  <button id="restart-btn" class="btn btn-secondary"><i class="fas fa-redo"></i> 重新测试</button>
                  <button id="reselect-btn" class="btn"><i class="fas fa-cog"></i> 重新选择题目数</button>
              </div>
          </div>
      </div>
  </div>

  <script>
      // 原始题库数据保持不变
      let originalQuestions = [
              {
      id: 16,
      question: "( ) 可以基于设备全生命周期的运行数据，提前预测设备关键部件的变化趋势、产品寿命和潜在风险，提前预测设备零部件的损坏时间，主动提前进行维护服务。",
      options: ["A. 设备资产全生命周期管理", "B. 设备状态监测", "C. 设备故障诊断", "D. 预测性维护"],
      answer: "D"
    },
    {
      id: 17,
      question: "2017年11月国务院发布的《关于深化\"互联网+先进制造业\"发展工业互联网的指导意见》明确要构建的三大功能体系是指：",
      options: ["A. 网络", "B. 平台", "C. 安全", "D. 以上全是"],
      answer: "D"
    },
    {
      id: 18,
      question: "5G与工业互联网融合出现的几大类典型场景是哪几类？",
      options: [
        "A. 5G+超高清视频、AR、VR、无人机、云端机器人、远程控制、机器视觉、云化AGV",
        "B. 5G+超高清视频、AR、VR、无人机、云端机器人、自动化控制、机器视觉、云化AGV",
        "C. 5G+超高清视频、AR、VR、无人机、工业机器人、远程控制、机器视觉、云化AGV",
        "D. 5G+超高清视频、AR、VR、无人机、云端机器人、远程控制、机器学习、云化AGV"
      ],
      answer: "A"
    },
    {
      id: 19,
      question: "InfluxDB时序数据库引擎主要包括以下哪些组件？",
      options: ["A. 写入前日志", "B. 缓存", "C. 时间序列合并树", "D. 以上全是"],
      answer: "D"
    },
    {
      id: 20,
      question: "IoT是什么的缩写？",
      options: ["A. Internet of Tables", "B. Internet of Things", "C. Internet of Tools", "D. Internet of Toys"],
      answer: "B"
    },
    {
      id: 21,
      question: "OPC UA的五大特性是什么？",
      options: [
        "A. 功能完整性、平台独立性、安全性、可扩展性、信息模型独立性",
        "B. 功能对等性、平台完整性、安全性、可扩展性、信息模型完整性",
        "C. 功能对等性、平台独立性、安全性、可扩展性、信息模型独立性",
        "D. 功能独立性、平台互补性、安全性、可扩展性、信息模型完整性"
      ],
      answer: "C"
    },
    {
      id: 22,
      question: "PLC的所有实验中，三色灯的所有参数采集时，数据类型选择？",
      options: ["A. Float", "B. Boolean", "C. Integer", "D. Double"],
      answer: "B"
    },
    {
      id: 23,
      question: "本次使用的PLC，中央处理器模块包含下列哪些功能？",
      options: [
        "A. 14路数字量输入",
        "B. 10路数字量输出",
        "C. 两路0-20V电压信号的模拟量输入",
        "D. 以上都是"
      ],
      answer: "D"
    },
    {
      id: 24,
      question: "边缘计算的主要目标是？",
      options: [
        "A. 提高数据中心效率",
        "B. 减少网络带宽使用",
        "C. 提高计算性能",
        "D. 将计算资源推向用户端"
      ],
      answer: "B"
    },
    {
      id: 25,
      question: "边缘计算对于哪种应用场景的安全性要求尤为重要？",
      options: ["A. 游戏开发", "B. 医疗保健", "C. 大规模数据存储", "D. 传统企业文件管理"],
      answer: "B"
    },
    // 添加更多题目
    {
      id: 26,
      question: "边缘计算对于哪种应用场景的实时性要求尤为重要？",
      options: ["A. 社交媒体", "B. 大规模数据分析", "C. 医疗诊断", "D. 电子邮件服务"],
      answer: "C"
    },
    {
      id: 27,
      question: "边缘计算对于提高大规模数据处理效率有何优势？",
      options: [
        "A. 减少数据传输至云端的频率",
        "B. 在云端进行所有数据分析",
        "C. 增加云端数据中心规模",
        "D. 提高网络带宽"
      ],
      answer: "A"
    },
    {
      id: 28,
      question: "边缘计算技术的主要目标是什么？",
      options: [
        "A. 提高云计算性能",
        "B. 减少网络带宽使用",
        "C. 提高计算性能",
        "D. 将计算资源推向用户端"
      ],
      answer: "B"
    },
    {
      id: 29,
      question: "边缘计算可以通过以下哪种方式来提高效率？",
      options: [
        "A. 设备数量",
        "B. 传感器数量",
        "C. 数据传输至云端的频率",
        "D. 云端计算的复杂性"
      ],
      answer: "C"
    },
    {
      id: 30,
      question: "边缘计算可以用于改善哪种应用场景的性能？",
      options: [
        "A. 高带宽网络",
        "B. 低延迟需求",
        "C. 大规模数据存储",
        "D. 云端服务器的负载均衡"
      ],
      answer: "B"
    },
    // 添加更多常用题目，确保至少有足够多的题目供选择
    {
      id: 31,
      question: "边缘计算可以在哪个方面提供更好的可扩展性？",
      options: ["A. 大规模批处理", "B. 实时数据处理", "C. 中央服务器", "D. 云端存储"],
      answer: "B"
    },
    {
      id: 32,
      question: "边缘计算如何改善电子邮件服务的实时性需求？",
      options: [
        "A. 在云端存储所有邮件数据",
        "B. 提高邮件传输速度",
        "C. 在云端进行所有邮件处理",
        "D. 减少邮件服务器数量"
      ],
      answer: "B"
    },
    {
      id: 33,
      question: "边缘计算如何改善教育领域的效率？",
      options: [
        "A. 提高学生上网速度",
        "B. 提供更多在线课程",
        "C. 在校园内实时分析学生学习数据",
        "D. 在云端存储所有教育资源"
      ],
      answer: "C"
    },
    {
      id: 34,
      question: "边缘计算如何提高农业生产的效率？",
      options: [
        "A. 通过增加农业设备数量",
        "B. 通过减少对云端的依赖",
        "C. 通过增加传感器的数量",
        "D. 通过将所有计算任务交给云端"
      ],
      answer: "B"
    },
    {
      id: 35,
      question: "边缘计算如何提高医疗设备的效率？",
      options: [
        "A. 在云端进行所有医疗数据分析",
        "B. 提高医疗设备的精度",
        "C. 在云端存储所有医疗数据",
        "D. 提高医疗设备的运行效率"
      ],
      answer: "A"
    },
    // 继续添加更多题目...
    {
      id: 36,
      question: "边缘计算如何提高物流管理的效率？",
      options: [
        "A. 减少货物运输速度",
        "B. 提高仓库存储效率",
        "C. 实时监测货物位置",
        "D. 在云端进行所有物流规划"
      ],
      answer: "C"
    },
    {
      id: 100,
      question: "下列对485集线器描述正确的是？",
      options: [
        "A. 集线器是一种共享设备，本身具有识别目的地址的功能",
        "B. 通过集线器对信号进行转发，使所有连接设备之间可以相互通讯",
        "C. 集线器不按照网络协议进行分类",
        "D. 以上都是"
      ],
      answer: "B"
    },
    {
      id: 150,
      question: "以下哪种传感器适用于光照检测？",
      options: ["A. 光电传感器", "B. 红外传感器", "C. 流量传感器", "D. 以上都是"],
      answer: "D"
    },
    {
      id: 200,
      question: "\"工业通信协议是指工业控制领域内双方实体完成通信或服务所必须遵循的规则和约定。通过通信通道和设备互联组成的多个地理位置的数据通信系统，要使其能协同工作实现信息交换和资源共享，它们之间必须具有共同语言，交流什么、怎样交流及合适交流，都必须遵循某种都能接收的规则，这个规则就是工业通信协议。\"这句话是否正确？",
      options: ["A. 正确", "B. 错误", "", ""],
      answer: "A"
    },
    {
      id: 250,
      question: "做工业数据采集需要遵循的两大原则是：目的性和经济性。",
      options: ["A. 正确", "B. 错误", "", ""],
      answer: "A"
    }
      ];
      
      // 全局变量
      let shuffledQuestions = [];
      let userAnswers = {};
      let results = {};
      let usedQuestionIndices = [];
      let currentMode = ''; // 当前模式：'exam' 或 'practice'
      
      // 作答计时器变量
      let timerInterval;
      let startTime = null; // 记录考试开始时间

      // 密码保护逻辑
      const password = 'jy5247';
      const passwordProtection = document.getElementById('password-protection');
      const modeSelection = document.getElementById('mode-selection');
      const questionCountSelection = document.getElementById('question-count-selection');
      const passwordInput = document.getElementById('password-input');
      const passwordSubmit = document.getElementById('password-submit');
      const errorMessage = document.getElementById('error-message');

      // 主题切换功能
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = themeToggle.querySelector('i');
      
      themeToggle.addEventListener('click', function() {
          document.body.classList.toggle('dark-theme');
          if(document.body.classList.contains('dark-theme')) {
              themeIcon.className = 'fas fa-sun';
          } else {
              themeIcon.className = 'fas fa-moon';
          }
      });

      passwordSubmit.addEventListener('click', function() {
          if (passwordInput.value === password) {
              passwordProtection.classList.add('hidden');
              modeSelection.classList.remove('hidden');
          } else {
              errorMessage.style.display = 'block';
              passwordInput.value = '';
              passwordInput.focus();
          }
      });
      
      // 回车提交密码
      passwordInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
              passwordSubmit.click();
          }
      });

      // 模式选择逻辑
      const practiceModeBtn = document.getElementById('practice-mode-btn');
      const examModeBtn = document.getElementById('exam-mode-btn');
      const currentModeDisplay = document.getElementById('current-mode');

      practiceModeBtn.addEventListener('click', function() {
          currentMode = 'practice';
          modeSelection.classList.add('hidden');
          questionCountSelection.classList.remove('hidden');
          currentModeDisplay.innerHTML = '<i class="fas fa-book"></i> 练习模式 - 答题后可立即查看答案';
          currentModeDisplay.style.color = '#27ae60';
      });

      examModeBtn.addEventListener('click', function() {
          currentMode = 'exam';
          modeSelection.classList.add('hidden');
          questionCountSelection.classList.remove('hidden');
          currentModeDisplay.innerHTML = '<i class="fas fa-clipboard-check"></i> 考试模式 - 提交后统一查看结果';
          currentModeDisplay.style.color = '#3498db';
      });

      // 题目数量选择逻辑
      const questionCountInput = document.getElementById('question-count-input');
      const questionCountSubmit = document.getElementById('question-count-submit');
      const countErrorMessage = document.getElementById('count-error-message');
      const examContent = document.getElementById('exam-content');

      questionCountSubmit.addEventListener('click', function() {
          const count = parseInt(questionCountInput.value);
          if (isNaN(count) || count < 1 || count > originalQuestions.length) {
              countErrorMessage.style.display = 'block';
              return;
          }
          // 确保隐藏考试结果区域，并显示考试区域（考试区域可能保留上次结果）
          document.getElementById('results').style.display = 'none';
          document.getElementById('exam-form').style.display = 'block';
          document.getElementById('submit-btn').style.display = currentMode === 'exam' ? 'block' : 'none';
          
          questionCountSelection.classList.add('hidden');
          examContent.classList.remove('hidden');
          initExam(count);
      });
      
      // 回车确认题目数量
      questionCountInput.addEventListener('keypress', function(e) {
          if (e.key === 'Enter') {
              questionCountSubmit.click();
          }
      });

      // 洗牌函数（Fisher-Yates 算法）
      function shuffle(array) {
          let currentIndex = array.length, temporaryValue, randomIndex;
          while (currentIndex !== 0) {
              randomIndex = Math.floor(Math.random() * currentIndex);
              currentIndex -= 1;
              temporaryValue = array[currentIndex];
              array[currentIndex] = array[randomIndex];
              array[randomIndex] = temporaryValue;
          }
          return array;
      }
      
      // 初始化考试：打乱题目、清空旧状态、启动计时器
      function initExam(count) {
          clearInterval(timerInterval);
          startTime = Date.now();
          timerInterval = setInterval(updateElapsedTime, 1000);
          
          // 清空状态
          userAnswers = {};
          results = {};
          shuffledQuestions = [];
          usedQuestionIndices = [];
          document.getElementById('exam-form').innerHTML = '';
          document.getElementById('progress-bar').style.width = '0';
          document.getElementById('timer').innerHTML = '<i class="fas fa-clock"></i> 已用时: 00:00';
          document.getElementById('final-time').textContent = "";
          
          // 打乱题库并选择题目
          const shuffled = shuffle(originalQuestions.slice());
          const actualCount = Math.min(count, shuffled.length);
          for (let i = 0; i < actualCount; i++) {
              shuffledQuestions.push(shuffled[i]);
              usedQuestionIndices.push(i);
          }
          
          // 生成题目
          const examForm = document.getElementById('exam-form');
          shuffledQuestions.forEach((q, index) => {
              const questionDiv = document.createElement('div');
              questionDiv.className = 'question fade-in';
              if (index === 0) questionDiv.classList.add('current-question');
              questionDiv.id = `question-${q.id}`;
              
              let optionsHtml = '';
              q.options.forEach(option => {
                  const optionLetter = option.charAt(0);
                  optionsHtml += `
                      <div class="option" data-option="${optionLetter}">
                          <label>
                              <input type="radio" name="question-${q.id}" value="${optionLetter}">
                              ${option}
                          </label>
                      </div>
                  `;
              });
              
              questionDiv.innerHTML = `
                  <div class="question-title">
                      <span class="question-number">${index + 1}. </span>
                      ${q.question}
                  </div>
                  <div class="options">
                      ${optionsHtml}
                  </div>
                  <div class="answer-feedback" id="feedback-${q.id}"></div>
              `;
              examForm.appendChild(questionDiv);
          });
          
          updateProgressBar();
          
          // 如果是练习模式，添加选项点击事件监听
          if (currentMode === 'practice') {
              document.querySelectorAll('.option').forEach(option => {
                  option.addEventListener('click', handlePracticeModeSelection);
              });
          }
      }
      
      // 练习模式下，点击选项后的处理
      function handlePracticeModeSelection(e) {
          const optionDiv = this;
          const questionDiv = optionDiv.closest('.question');
          const questionId = parseInt(questionDiv.id.replace('question-', ''));
          const selectedOption = optionDiv.dataset.option;
          const feedbackDiv = document.getElementById(`feedback-${questionId}`);
          
          // 查找对应的题目和正确答案
          const question = shuffledQuestions.find(q => q.id === questionId);
          const correctAnswer = question.answer;
          
          // 保存用户答案
          userAnswers[questionId] = selectedOption;
          
          // 更新UI：标记所有选项
          questionDiv.querySelectorAll('.option').forEach(opt => {
              opt.classList.remove('selected');
              if (opt.dataset.option === selectedOption) {
                  opt.classList.add('selected');
              }
          });
          
          // 显示反馈
          feedbackDiv.style.display = 'block';
          if (selectedOption === correctAnswer) {
              feedbackDiv.className = 'answer-feedback correct';
              feedbackDiv.innerHTML = `<i class="fas fa-check-circle"></i> 正确！答案是：${correctAnswer}`;
          } else {
              feedbackDiv.className = 'answer-feedback incorrect';
              feedbackDiv.innerHTML = `<i class="fas fa-times-circle"></i> 错误！正确答案是：${correctAnswer}`;
          }
          
          updateProgressBar();
          
          // 移除事件监听，防止重复点击
          questionDiv.querySelectorAll('.option').forEach(opt => {
              opt.removeEventListener('click', handlePracticeModeSelection);
          });
          
          // 滚动到下一题（如果有）
          const currentIndex = Array.from(document.querySelectorAll('.question')).indexOf(questionDiv);
          if (currentIndex < shuffledQuestions.length - 1) {
              const nextQuestion = document.querySelectorAll('.question')[currentIndex + 1];
              setTimeout(() => {
                  document.querySelectorAll('.question').forEach(q => q.classList.remove('current-question'));
                  nextQuestion.classList.add('current-question');
                  nextQuestion.scrollIntoView({ behavior: 'smooth', block: 'center' });
              }, 800);
          } else {
              // 如果是最后一题，显示完成消息
              setTimeout(() => {
                  alert('恭喜！您已完成所有题目。');
                  
                  // 计算结果并显示
                  calculateResults();
                  document.getElementById('exam-form').style.display = 'none';
                  document.getElementById('results').style.display = 'block';
              }, 800);
          }
      }
      
      // 更新时间显示（格式：mm:ss）
      function updateElapsedTime() {
          const elapsedSeconds = Math.floor((Date.now() - startTime) / 1000);
          const minutes = Math.floor(elapsedSeconds / 60);
          const seconds = elapsedSeconds % 60;
          const formattedTime = 
              (minutes < 10 ? "0" + minutes : minutes) + ":" + 
              (seconds < 10 ? "0" + seconds : seconds);
          document.getElementById('timer').innerHTML = '<i class="fas fa-clock"></i> 已用时: ' + formattedTime;
      }
      
      function updateProgressBar() {
          const answered = Object.keys(userAnswers).length;
          const total = shuffledQuestions.length;
          const percentage = (answered / total) * 100;
          document.getElementById('progress-bar').style.width = `${percentage}%`;
      }
      
      function calculateResults() {
          clearInterval(timerInterval);
          const totalElapsed = Math.floor((Date.now() - startTime) / 1000);
          const minutes = Math.floor(totalElapsed / 60);
          const seconds = totalElapsed % 60;
          const formattedTotalTime = 
              (minutes < 10 ? "0" + minutes : minutes) + ":" + 
              (seconds < 10 ? "0" + seconds : seconds);
          
          let correct = 0;
          shuffledQuestions.forEach(q => {
              const isCorrect = (userAnswers[q.id] === q.answer);
              results[q.id] = {
                  question: q,
                  userAnswer: userAnswers[q.id] || '',
                  isCorrect: isCorrect
              };
              if (isCorrect) correct++;
          });
          
          const accuracy = ((correct / shuffledQuestions.length) * 100).toFixed(1);
          
          // 更新结果统计
          document.getElementById('score').textContent = correct;
          document.getElementById('total').textContent = shuffledQuestions.length;
          document.getElementById('accuracy').textContent = `${accuracy}%`;
          document.getElementById('final-time').textContent = "总作答用时：" + formattedTotalTime;
          
          // 更新结果统计卡片
          document.getElementById('summary-score').textContent = correct;
          document.getElementById('summary-total').textContent = shuffledQuestions.length;
          document.getElementById('summary-accuracy').textContent = `${accuracy}%`;
          document.getElementById('summary-time').textContent = formattedTotalTime;
          
          displayResults('all');
      }
      
      function submitExam() {
          // 检查是否全部作答，否则提示并滚动定位到未答题目
          for (let i = 0; i < shuffledQuestions.length; i++) {
              const q = shuffledQuestions[i];
              if (!userAnswers[q.id] || userAnswers[q.id] === '') {
                  const questionElem = document.getElementById(`question-${q.id}`);
                  if (questionElem) {
                      document.querySelectorAll('.question').forEach(q => q.classList.remove('current-question'));
                      questionElem.classList.add('current-question');
                      questionElem.scrollIntoView({ behavior: 'smooth', block: 'center' });
                  }
                  alert('请完成所有题目再提交答案！');
                  return;
              }
          }
          
          calculateResults();
          
          // 隐藏考试区域、显示结果区域
          document.getElementById('exam-form').style.display = 'none';
          document.getElementById('submit-btn').style.display = 'none';
          document.getElementById('results').style.display = 'block';
          window.scrollTo(0, 0);
      }
      
      function displayResults(filter) {
          const resultDetails = document.getElementById('result-details');
          resultDetails.innerHTML = '';
          Object.values(results).forEach((result, index) => {
              if (filter === 'incorrect' && result.isCorrect) return;
              const resultDiv = document.createElement('div');
              resultDiv.className = `question fade-in ${result.isCorrect ? 'correct' : 'incorrect'}`;
              resultDiv.innerHTML = `
                  <div class="question-title">
                      <span class="question-number">${index + 1}. </span>
                      ${result.question.question}
                      <span class="status ${result.isCorrect ? 'correct' : 'incorrect'}">
                          ${result.isCorrect ? '<i class="fas fa-check"></i> 正确' : '<i class="fas fa-times"></i> 错误'}
                      </span>
                  </div>
                  <div class="options">
                      ${result.question.options.map(option => {
                          const letter = option.charAt(0);
                          let className = '';
                          let icon = '';
                          
                          if (letter === result.question.answer) {
                              className = 'correct';
                              icon = '<i class="fas fa-check-circle"></i>';
                          } else if (letter === result.userAnswer && letter !== result.question.answer) {
                              className = 'incorrect';
                              icon = '<i class="fas fa-times-circle"></i>';
                          }
                          
                          return `
                              <div class="option ${className}">
                                  ${option} ${icon}
                              </div>
                          `;
                      }).join('')}
                  </div>
              `;
              resultDetails.appendChild(resultDiv);
          });
      }
      
      // 监听考试模式下的答案选项变化
      document.addEventListener('change', function(e) {
          if (currentMode === 'exam' && e.target.type === 'radio' && e.target.name.startsWith('question-')) {
              const questionId = parseInt(e.target.name.replace('question-', ''));
              userAnswers[questionId] = e.target.value;
              
              // 更新选项UI
              const questionDiv = e.target.closest('.question');
              questionDiv.querySelectorAll('.option').forEach(opt => {
                  opt.classList.remove('selected');
              });
              e.target.closest('.option').classList.add('selected');
              
              updateProgressBar();
          }
      });
      
      // 提交答案按钮事件
      document.getElementById('submit-btn').addEventListener('click', submitExam);
      
      // "重新测试"按钮：保持原题数重新考试
      document.getElementById('restart-btn').addEventListener('click', function() {
          clearInterval(timerInterval);
          document.getElementById('exam-form').style.display = 'block';
          document.getElementById('submit-btn').style.display = currentMode === 'exam' ? 'block' : 'none';
          document.getElementById('results').style.display = 'none';
          initExam(shuffledQuestions.length);
      });
      
      // "重新选择题目数"按钮：完全重置状态后，回到模式选择界面
      document.getElementById('reselect-btn').addEventListener('click', function() {
          clearInterval(timerInterval);
          timerInterval = null;
          startTime = null;
          userAnswers = {};
          results = {};
          shuffledQuestions = [];
          usedQuestionIndices = [];
          document.getElementById('exam-form').innerHTML = '';
          document.getElementById('progress-bar').style.width = '0';
          document.getElementById('timer').innerHTML = '<i class="fas fa-clock"></i> 已用时: 00:00';
          document.getElementById('final-time').textContent = "";
          
          // 直接隐藏考试区域和结果区域，再显示模式选择界面
          examContent.classList.add('hidden');
          modeSelection.classList.remove('hidden');
          questionCountInput.value = '';
          countErrorMessage.style.display = 'none';
      });
      
      document.querySelectorAll('.filter-btn').forEach(btn => {
          btn.addEventListener('click', function() {
              document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
              this.classList.add('active');
              displayResults(this.getAttribute('data-filter'));
          });
      });
  </script>
</body>
</html>
